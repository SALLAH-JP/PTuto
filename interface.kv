<MyScreenManager>:
    AccueilScreen:
    JeuScreen
    SimulationScreen:
    RobotScreen:
    OptionsScreen:

<AccueilScreen>:
    name: "accueil"
    BoxLayout:
        orientation: 'vertical'
        spacing: 20
        padding: 50

        canvas.before:
            Rectangle:
                source: "assets/backgrounds/background.jpg"
                pos: self.pos
                size: self.size

        Label:
            text: "Bienvenue sur le Simulateur de Robot"
            font_size: "32sp"
            color: 1, 1, 1, 1

        Button:
            text: "Démarrer la simulation"
            size_hint: (0.6, 0.15)
            pos_hint: {"center_x": 0.5}
            on_release: root.on_simuler_pressed()
        Button:
            text: "Connecter un robot"
            size_hint: (0.6, 0.15)
            pos_hint: {"center_x": 0.5}
            on_release: app.root.current = "robot"
        Button:
            text: "Options et paramètres"
            size_hint: (0.6, 0.15)
            pos_hint: {"center_x": 0.5}
            on_release: app.root.current = "options"

<JeuScreen>:
    name: "jeu"

    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 10

        canvas.before:
            Rectangle:
                source: "assets/backgrounds/plage.jpg"
                pos: self.pos
                size: self.size

        Widget:
            id: jeu_widget

        Button:
            text: "Générer des déchets"
            size_hint: 0.2, 0.1
            pos_hint: {"center_x": 0.5}
            on_release: root.generate_dechets()
        Button:
            text: "Retour à l'accueil"
            size_hint: 0.2, 0.1
            pos_hint: {"center_x": 0.5}
            on_release: app.root.current = "accueil"

<SimulationScreen>:
    name: "simulation"

    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 10

        canvas.before:
            Rectangle:
                pos: self.pos
                size: self.size
                source: "assets/backgrounds/plage.jpg"

        Label:
            text: "Bienvenue dans le Jeu !"
            size_hint_y: None
            height: 50

        Widget:
            id: simulation_widget

        Button:
            text: "Retour à l'accueil"
            size_hint: 0.2, 0.1
            pos_hint: {"center_x": 0.5}
            on_release: app.root.current = "accueil"

<RobotScreen>:
    name: "robot"

    BoxLayout:
        orientation: 'horizontal'
        padding: dp(20)
        spacing: dp(10)

        # Partie gauche : Conteneur vertical pour l'image et le bouton
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.3   # Occupe 30% de la largeur totale
            spacing: dp(10)

            # Label de statut global
            Label:
                id: status_label
                text: ''
                size_hint_y: None
                height: dp(30)
                color: 1,1,1,1

            
            Image:
                source: "assets/robot/robot2.jpg"
                size_hint_y: 1
            
            Button:
                text: "Retour à l'accueil"
                size_hint_y: None
                height: dp(50)
                on_release: app.root.current = "accueil"  # Retourne à l'écran d'accueil

        # Partie droite : Onglets pour les connexions
        TabbedPanel:
            do_default_tab: False  # Supprime le premier onglet par défaut
            tab_pos: 'top_mid'
            tab_width: 200

            TabbedPanelItem:
                text: "USB"
                BoxLayout:
                    orientation: 'vertical'
                    padding: dp(20)
                    spacing: dp(10)

                    Label:
                        text: "Connexion USB"
                        font_size: '24sp'
                        size_hint_y: None
                        height: dp(50)

                    Label:
                        text: "Port COM :"
                    TextInput:
                        id: port_input
                        hint_text: "Entrez le port COM"
                        multiline: False
                        size_hint_y: None
                        height: dp(40)

                    Button:
                        text: "Connecter"
                        on_release: root.connect_usb(port_input.text)

            TabbedPanelItem:
                text: "Bluetooth"
                BoxLayout:
                    orientation: 'vertical'
                    padding: dp(20)
                    spacing: dp(10)

                    Label:
                        text: "Connexion Bluetooth"
                        font_size: '24sp'
                        size_hint_y: None
                        height: dp(50)

                    Label:
                        text: "Address MAC :"
                    TextInput:
                        id: address_input
                        hint_text: "Entrez le port COM"
                        multiline: False
                        size_hint_y: None
                        height: dp(40)

                    Button:
                        text: "Pairer"
                        on_release: root.connect_bluetooth(address_input.text)

            TabbedPanelItem:
                text: "Wi-Fi"
                BoxLayout:
                    orientation: 'vertical'
                    padding: dp(20)
                    spacing: dp(10)

                    Label:
                        text: "Connexion Wi-Fi"
                        font_size: '24sp'
                        size_hint_y: None
                        height: dp(50)

                    Label:
                        text: "Adresse IP :"
                    TextInput:
                        id: wifi_ip_input
                        hint_text: "Entrez l'adresse IP"
                        multiline: False
                        size_hint_y: None
                        height: dp(40)

                    Label:
                        text: "Port :"
                    TextInput:
                        id: wifi_port_input
                        hint_text: "Entrez le port"
                        password: True
                        multiline: False
                        size_hint_y: None
                        height: dp(40)

                    Button:
                        text: "Connecter"
                        on_release: root.connect_wifi(wifi_ip_input.text, wifi_port_input.text)

<OptionsScreen>:
    name: "options"

    BoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(10)

        # Entête de l'écran
        Label:
            text: "Options et Paramètres"
            font_size: "24sp"
            size_hint_y: 0.1

        # Formulaire sous forme de grille
        GridLayout:
            cols: 2
            spacing: dp(10)
            size_hint_y: 0.8

            # Champ pour le nombre de déchets
            Label:
                text: "Nombre de déchets :"
                halign: "right"
            TextInput:
                id: nb_dechets
                multiline: False

            # Champ pour la largeur de la plage
            Label:
                text: "Largeur de la plage (m) :"
                halign: "right"
            TextInput:
                id: largeur_plage
                multiline: False

            # Champ pour la longueur de la plage
            Label:
                text: "Longueur de la plage (m) :"
                halign: "right"
            TextInput:
                id: longueur_plage
                multiline: False

            # Champ supplémentaire : Taux de recyclage
            Label:
                text: "Taux de recyclage (%) :"
                halign: "right"
            TextInput:
                id: taux_recyclage
                multiline: False

            # Champ supplémentaire : Vitesse de simulation
            Label:
                text: "Vitesse de simulation :"
                halign: "right"
            TextInput:
                id: vitesse_simulation
                multiline: False

            # Exemple d'un paramètre sous forme de switch (activer/désactiver un mode)
            Label:
                text: "Mode avancé :"
                halign: "right"
            Switch:
                id: mode_avance

            Label:
                id: error_label
                text: ""
                color: 1, 0, 0, 1  # Texte rouge pour signaler une erreur
                font_size: "14sp"
                opacity: 0  # Caché par défaut


        # Bouton pour enregistrer/appliquer les paramètres
        Button:
            text: "Enregistrer les paramètres"
            size_hint_y: 0.1
            on_press: root.enregistrer_parametres()
        Button:
            text: "Retour à l'accueil"
            size_hint_y: 0.1
            on_press: app.root.current = "accueil"
