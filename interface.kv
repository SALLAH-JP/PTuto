<MyScreenManager>:
    AccueilScreen:
    JeuScreen:
    SimulationScreen:
    RobotScreen:
    OptionsScreen:

<AccueilScreen>:
    name: "accueil"
    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            orientation: 'vertical'

            canvas.before:
                Rectangle:
                    source: "assets/backgrounds/background.jpg"
                    pos: self.pos
                    size: self.size

            Label:
                text: "Bienvenue sur le Simulateur de Robot"
                font_size: "32sp"
                color: 1, 1, 1, 1

            ButtonIcon
                text: "Démarrer la simulation"
                icon_source: "assets/icones/icone_plage.png"
                size_hint: (0.4, 0.15)
                pos_hint: {"center_x": 0.5}
                on_release: root.on_simuler_pressed()

            ButtonIcon:
                text: "Connecter un robot"
                icon_source: "assets/icones/robot.png"
                size_hint: (0.4, 0.15)
                pos_hint: {"center_x": 0.5}
                on_release: app.root.current = "robot"


            ButtonIcon:
                icon_source: "assets/icones/icone_option.png"
                text: "Options et paramètres"
                size_hint: (0.4, 0.15)
                pos_hint: {"center_x": 0.5}
                on_release: app.root.current = "options"

<JeuScreen>:
    name: "jeu"

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            size_hint_y: 0.1125
            padding: dp(5)
            spacing: dp(10)
            canvas.before:
                Color:
                    rgba: 0.2, 0.2, 0.2, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(10)]

            ButtonIcon:
                icon_source: "assets/icones/icone_home.png"
                text: ""
                size_hint: (0.4, 0.8)
                pos_hint: {"center_y": 0.5}
                on_release: app.root.current = "accueil"

            Label:
                id: score_label
                text: "Score: 0/10"
                font_size: '20sp'
            Label:
                id: life_label
                text: "Vies: 3"
                font_size: '20sp'

            Spinner:
                id: level_spinner
                text: "Niveau 1"
                values: ["Niveau 1", "Niveau 2", "Niveau 3"]
                size_hint: (None, None)
                size: dp(120), dp(40)
                pos_hint: {"center_y": 0.5}
                # Lorsqu'on change le choix, on lance le chargement du niveau
                on_text: root.load_level(self.text)


        BoxLayout:
            canvas.before:
                Rectangle:
                    source: "assets/backgrounds/plage.jpg"
                    pos: self.pos
                    size: self.size

            Widget:
                id: jeu_widget

            

<SimulationScreen>:
    name: "simulation"

    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 10

        canvas.before:
            Rectangle:
                pos: self.pos
                size: self.size
                source: "assets/backgrounds/plage.jpg"

        Label:
            text: "Bienvenue dans le Jeu !"
            size_hint_y: None
            height: 50

        Widget:
            id: simulation_widget

        ButtonIcon:
            icon_source: "assets/icones/icone_home.png"
            text: "Accueil"
            size_hint: (0.4, 0.15)
            pos_hint: {"center_x": 0.5}
            on_release: app.root.current = "accueil"

<RobotScreen>:
    name: "robot"

    BoxLayout:
        orientation: 'horizontal'
        padding: dp(20)
        spacing: dp(10)

        # Partie gauche : Conteneur vertical pour l'image et le bouton
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.3   # Occupe 30% de la largeur totale
            spacing: dp(10)

            # Label de statut global
            Label:
                id: status_label
                text: ''
                size_hint_y: None
                height: dp(30)
                color: 1,1,1,1

            Image:
                source: "assets/robot/robot2.jpg"
                size_hint_y: 1
            
            ButtonIcon:
                icon_source: "assets/icones/icone_home.png"
                text: "Accueil"
                size_hint: (1, 0.15)
                on_release: app.root.current = "accueil"  # Retourne à l'écran d'accueil

        BoxLayout:
            orientation: 'horizontal'
            spacing: 0  # Suppression de l'espace entre les deux zones

            canvas.before:
                Color:
                    rgba: 0.5, 0.5, 0.5, 1  # Fond gris
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(10)]

            TabbedPanel:
                do_default_tab: False  # Supprime le premier onglet par défaut
                tab_pos: 'top_mid'
                tab_width: 200
                tab_height: dp(75)

                canvas.after:
                    # Tracer une ligne noire entre les onglets et le contenu
                    Color:
                        rgba: 1, 1, 1, 1  # Couleur noire
                    Line:
                        points: [self.x, self.top - self.tab_height, self.right, self.top - self.tab_height]
                        width: dp(1)


                TabbedPanelItem:
                    text: "USB"
                    BoxLayout:
                        orientation: 'vertical'
                        padding: dp(20)
                        spacing: dp(10)

                        Label:
                            text: "Connexion USB"
                            font_size: '24sp'
                            size_hint_y: None

                        Label:
                            text: "Port COM :"
                        TextInput:
                            id: port_input
                            hint_text: "Entrez le port COM"
                            multiline: False
                            size_hint_y: None
                            height: dp(40)

                        ButtonIcon:
                            icon_source: "assets/icones/icone_link.png"
                            size_hint: (0.4, 0.2)
                            text: "Connecter"
                            on_release: root.connect_usb(port_input.text)

                TabbedPanelItem:
                    text: "Bluetooth"
                    BoxLayout:
                        orientation: 'vertical'
                        padding: dp(20)
                        spacing: dp(10)

                        Label:
                            text: "Connexion Bluetooth"
                            font_size: '24sp'
                            size_hint_y: None
                            height: dp(50)

                        Label:
                            text: "Address MAC :"
                        TextInput:
                            id: address_input
                            hint_text: "Entrez le port COM"
                            multiline: False
                            size_hint_y: None
                            height: dp(40)

                        ButtonIcon:
                            icon_source: "assets/icones/icone_link.png"
                            size_hint: (0.4, 0.2)
                            text: "Pairer"
                            on_release: root.connect_bluetooth(address_input.text)

                TabbedPanelItem:
                    text: "Wi-Fi"
                    BoxLayout:
                        orientation: 'vertical'
                        padding: dp(20)
                        spacing: dp(10)

                        Label:
                            text: "Connexion Wi-Fi"
                            font_size: '24sp'
                            size_hint_y: None
                            height: dp(50)

                        Label:
                            text: "Adresse IP :"
                        TextInput:
                            id: wifi_ip_input
                            hint_text: "Entrez l'adresse IP"
                            multiline: False
                            size_hint_y: None
                            height: dp(40)

                        Label:
                            text: "Port :"
                        TextInput:
                            id: wifi_port_input
                            hint_text: "Entrez le port"
                            password: True
                            multiline: False
                            size_hint_y: None
                            height: dp(40)

                        ButtonIcon:
                            icon_source: "assets/icones/icone_link.png"
                            size_hint: (0.4, 0.6)
                            text: "Connecter"
                            on_release: root.connect_wifi(wifi_ip_input.text, wifi_port_input.text)

<OptionsScreen>:
    name: "options"

    BoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(10)

        BoxLayout:
            orientation: "vertical"
            size_hint_y: 0.9      # Ajustez cette valeur selon vos besoins

            canvas.before:
                Color:
                    rgba: 0.5, 0.5, 0.5, 1  # Couleur de fond grise
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(10)] 


            # Entête de l'écran
            Label:
                text: "Options et Paramètres"
                font_size: "24sp"
                size_hint_y: 0.1
                padding: 20

            # Formulaire sous forme de grille
            GridLayout:
                cols: 2
                spacing: dp(10)
                size_hint_y: 0.8

                # Champ pour le nombre de déchets
                Label:
                    text: "Nombre de déchets :"
                    font_size: '20sp'
                    halign: "right"
                TextInput:
                    id: nb_dechets
                    multiline: False

                # Champ pour la largeur de la plage
                Label:
                    text: "Largeur de la plage (m) :"
                    font_size: '20sp'
                    halign: "right"
                TextInput:
                    id: largeur_plage
                    multiline: False

                # Champ pour la longueur de la plage
                Label:
                    text: "Longueur de la plage (m) :"
                    font_size: '20sp'
                    halign: "right"
                TextInput:
                    id: longueur_plage
                    multiline: False

                # Champ supplémentaire : Taux de recyclage
                Label:
                    text: "Taux de recyclage (%) :"
                    font_size: '20sp'
                    halign: "right"
                TextInput:
                    id: taux_recyclage
                    multiline: False

                # Champ supplémentaire : Vitesse de simulation
                Label:
                    text: "Vitesse de simulation :"
                    font_size: '20sp'
                    halign: "right"
                TextInput:
                    id: vitesse_simulation
                    multiline: False

                # Exemple d'un paramètre sous forme de switch (activer/désactiver un mode)
                Label:
                    text: "Mode avancé :"
                    font_size: '20sp'
                    halign: "right"
                Switch:
                    id: mode_avance

                Label:
                    id: error_label
                    text: ""
                    color: 1, 0, 0, 1  # Texte rouge pour signaler une erreur
                    font_size: "14sp"
                    opacity: 0  # Caché par défaut


        # Bouton pour enregistrer/appliquer les paramètres
        ButtonIcon:
            icon_source: "assets/icones/icone_save.png"
            text: "Enregistrer les paramètres"
            size_hint: (0.4, 0.1)
            on_press: root.enregistrer_parametres()
        ButtonIcon:
            icon_source: "assets/icones/icone_home.png"
            size_hint: (0.4, 0.1)
            text: "Retour à l'accueil"
            on_press: app.root.current = "accueil"